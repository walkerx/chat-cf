# è€ç”¨æˆ·æ˜µç§°è®¾ç½®åŠŸèƒ½

## æ¦‚è¿°
ä¸ºå·²ç™»å½•çš„è€ç”¨æˆ·æ·»åŠ äº†éšæ—¶è®¾ç½®/ä¿®æ”¹æ˜µç§°çš„åŠŸèƒ½ï¼Œé€šè¿‡ç”¨æˆ·èœå•ï¼ˆUser Menuï¼‰æä¾›ä¾¿æ·çš„è®¿é—®å…¥å£ã€‚

## æ–°å¢åŠŸèƒ½

### 1. ç”¨æˆ·èœå•ç»„ä»¶ (UserMenu)
**æ–‡ä»¶**: `public/src/components/UserMenu.tsx`

#### åŠŸèƒ½ç‰¹æ€§
- **ä¸‹æ‹‰èœå•**: ç‚¹å‡»ç”¨æˆ·å¤´åƒ/åç§°æ˜¾ç¤ºä¸‹æ‹‰èœå•
- **ç”¨æˆ·ä¿¡æ¯æ˜¾ç¤º**:
  - ç”¨æˆ·é‚®ç®±
  - å½“å‰æ˜µç§°ï¼ˆå¦‚æœå·²è®¾ç½®ï¼‰
  - å¤´åƒï¼ˆæ˜µç§°é¦–å­—æ¯ï¼Œæ¸å˜èƒŒæ™¯ï¼‰
- **èœå•é€‰é¡¹**:
  - âœï¸ Edit Username / Set Username
  - ğŸšª Sign Out
- **ç‚¹å‡»å¤–éƒ¨å…³é—­**: è‡ªåŠ¨æ£€æµ‹å¤–éƒ¨ç‚¹å‡»å¹¶å…³é—­èœå•

#### æŠ€æœ¯å®ç°
```typescript
export function UserMenu() {
    const { user, username, signOut, updateUsername } = useAuth();
    const [showMenu, setShowMenu] = useState(false);
    const [showUsernameEdit, setShowUsernameEdit] = useState(false);
    
    // ç‚¹å‡»å¤–éƒ¨å…³é—­èœå•
    useEffect(() => {
        function handleClickOutside(event: MouseEvent) {
            if (menuRef.current && !menuRef.current.contains(event.target as Node)) {
                setShowMenu(false);
            }
        }
        // ...
    }, [showMenu]);
    
    // ...
}
```

### 2. é›†æˆåˆ°é¡µé¢å¤´éƒ¨

#### Gallery é¡µé¢
**æ–‡ä»¶**: `public/src/components/GalleryHeader.tsx`

å˜æ›´ï¼š
- å·²ç™»å½•ç”¨æˆ·ï¼šæ˜¾ç¤º `<UserMenu />` æ›¿ä»£ "Sign Out" æŒ‰é’®
- æœªç™»å½•ç”¨æˆ·ï¼šæ˜¾ç¤º "Sign In" æŒ‰é’®

#### Chat é¡µé¢
**æ–‡ä»¶**: `public/src/components/ChatHeader.tsx`

å˜æ›´ï¼š
- å·²ç™»å½•ç”¨æˆ·ï¼šæ˜¾ç¤º `<UserMenu />` æ›¿ä»£ "Sign Out" æŒ‰é’®
- æœªç™»å½•ç”¨æˆ·ï¼šæ˜¾ç¤º "Sign In" æŒ‰é’®

### 3. æ ·å¼è®¾è®¡

#### ç”¨æˆ·èœå•è§¦å‘æŒ‰é’®
- æ¸å˜å¤´åƒåœ†åœˆï¼ˆæ˜µç§°é¦–å­—æ¯ï¼‰
- ç”¨æˆ·åæ˜¾ç¤ºï¼ˆæœ€å¤š 120pxï¼Œè¶…å‡ºçœç•¥ï¼‰
- ä¸‹æ‹‰ç®­å¤´ï¼ˆæ‚¬åœæ—¶æ—‹è½¬ï¼‰
- æ‚¬åœæ•ˆæœï¼šéœ“è™¹è“è‰²è¾¹æ¡†

#### ä¸‹æ‹‰èœå•
- æš—è‰²èƒŒæ™¯ + æ¨¡ç³Šæ•ˆæœ
- æ¸å˜é¡¶éƒ¨è¾¹æ¡†
- æ»‘å…¥åŠ¨ç”»
- ç”¨æˆ·ä¿¡æ¯åŒºåŸŸï¼ˆé‚®ç®± + æ˜µç§°ï¼‰
- èœå•é¡¹æ‚¬åœé«˜äº®
- å±é™©æ“ä½œï¼ˆSign Outï¼‰çº¢è‰²é«˜äº®

## ç”¨æˆ·ä½“éªŒæµç¨‹

### è€ç”¨æˆ·è®¾ç½®æ˜µç§°
```
1. ç”¨æˆ·ç™»å½•ï¼ˆå·²æœ‰è´¦æˆ·ï¼Œæœªè®¾ç½®æ˜µç§°ï¼‰
   â†“
2. åœ¨ Gallery æˆ– Chat é¡µé¢çœ‹åˆ°ç”¨æˆ·èœå•ï¼ˆæ˜¾ç¤ºé‚®ç®±å‰ç¼€ï¼‰
   â†“
3. ç‚¹å‡»ç”¨æˆ·èœå• â†’ æ˜¾ç¤ºä¸‹æ‹‰èœå•
   â†“
4. ç‚¹å‡» "Set Username"
   â†“
5. å¼¹å‡º UsernameSetup æ¨¡æ€æ¡†
   â†“
6. è¾“å…¥æ˜µç§°å¹¶ä¿å­˜
   â†“
7. èœå•æ›´æ–°æ˜¾ç¤ºæ–°æ˜µç§°
```

### ä¿®æ”¹æ˜µç§°
```
1. ç‚¹å‡»ç”¨æˆ·èœå•
   â†“
2. çœ‹åˆ°å½“å‰æ˜µç§°æ˜¾ç¤ºä¸º @username
   â†“
3. ç‚¹å‡» "Edit Username"
   â†“
4. UsernameSetup æ¨¡æ€æ¡†é¢„å¡«å……å½“å‰æ˜µç§°
   â†“
5. ä¿®æ”¹å¹¶ä¿å­˜
   â†“
6. ç«‹å³ç”Ÿæ•ˆ
```

## æŠ€æœ¯ç»†èŠ‚

### ç»„ä»¶å±‚çº§
```
GalleryPage / ChatPage
  â””â”€ GalleryHeader / ChatHeader
      â””â”€ UserMenu (if user logged in)
          â”œâ”€ user-menu-trigger (button)
          â”‚   â”œâ”€ user-avatar (circle with initial)
          â”‚   â”œâ”€ user-name (display name)
          â”‚   â””â”€ user-menu-arrow (â–¼)
          â””â”€ user-menu-dropdown (when open)
              â”œâ”€ user-menu-header
              â”‚   â”œâ”€ user-menu-email
              â”‚   â””â”€ user-menu-username (@username)
              â”œâ”€ user-menu-item (Edit Username)
              â””â”€ user-menu-item-danger (Sign Out)
```

### çŠ¶æ€ç®¡ç†
- `showMenu`: æ§åˆ¶ä¸‹æ‹‰èœå•æ˜¾ç¤º/éšè—
- `showUsernameEdit`: æ§åˆ¶ UsernameSetup æ¨¡æ€æ¡†æ˜¾ç¤º
- `menuRef`: ç”¨äºæ£€æµ‹å¤–éƒ¨ç‚¹å‡»

### æ ·å¼æ–‡ä»¶
1. **gallery.css**: å®Œæ•´çš„ UserMenu æ ·å¼
2. **chat.css**: ChatHeader ä¸­çš„ UserMenu æ ·å¼ï¼ˆéƒ¨åˆ†å¤ç”¨ï¼‰

## æ ·å¼ç±»å

### ç”¨æˆ·èœå•
- `.user-menu` - å®¹å™¨
- `.user-menu-trigger` - è§¦å‘æŒ‰é’®
- `.user-avatar` - å¤´åƒåœ†åœˆ
- `.user-name` - ç”¨æˆ·åæ–‡æœ¬
- `.user-menu-arrow` - ä¸‹æ‹‰ç®­å¤´
- `.user-menu-dropdown` - ä¸‹æ‹‰èœå•å®¹å™¨

### ä¸‹æ‹‰èœå•å†…å®¹
- `.user-menu-header` - å¤´éƒ¨ä¿¡æ¯åŒºåŸŸ
- `.user-menu-email` - é‚®ç®±æ˜¾ç¤º
- `.user-menu-username` - æ˜µç§°æ˜¾ç¤ºï¼ˆ@usernameï¼‰
- `.user-menu-divider` - åˆ†éš”çº¿
- `.user-menu-item` - èœå•é¡¹
- `.user-menu-icon` - èœå•é¡¹å›¾æ ‡
- `.user-menu-item-danger` - å±é™©æ“ä½œæ ·å¼

## åŠ¨ç”»æ•ˆæœ

### slideDown åŠ¨ç”»
```css
@keyframes slideDown {
    from {
        opacity: 0;
        transform: translateY(-10px);
    }
    to {
        opacity: 1;
        transform: translateY(0);
    }
}
```

### ç®­å¤´æ—‹è½¬
```css
.user-menu-trigger[aria-expanded="true"] .user-menu-arrow {
    transform: rotate(180deg);
}
```

## æ–‡ä»¶å˜æ›´æ€»ç»“

### æ–°å»ºæ–‡ä»¶
1. `public/src/components/UserMenu.tsx` - ç”¨æˆ·èœå•ç»„ä»¶

### ä¿®æ”¹æ–‡ä»¶
1. `public/src/components/GalleryHeader.tsx` - é›†æˆ UserMenu
2. `public/src/components/ChatHeader.tsx` - é›†æˆ UserMenu
3. `public/src/styles/gallery.css` - æ·»åŠ  UserMenu æ ·å¼
4. `public/src/styles/chat.css` - æ·»åŠ  ChatHeader ä¸­çš„ UserMenu æ ·å¼

## å¯¹æ¯”ï¼šæ–°ç”¨æˆ· vs è€ç”¨æˆ·

| åœºæ™¯ | æ–°ç”¨æˆ· | è€ç”¨æˆ· |
|------|--------|--------|
| é¦–æ¬¡ç™»å½• | è‡ªåŠ¨å¼¹å‡ºæ˜µç§°è®¾ç½®çª—å£ | çœ‹åˆ°ç”¨æˆ·èœå•ï¼ˆæ˜¾ç¤ºé‚®ç®±å‰ç¼€ï¼‰ |
| è®¾ç½®æ˜µç§° | å¿…é¡»è®¾ç½®æˆ–è·³è¿‡ | ä¸»åŠ¨ç‚¹å‡»èœå• â†’ Set Username |
| ä¿®æ”¹æ˜µç§° | é€šè¿‡ç”¨æˆ·èœå• | é€šè¿‡ç”¨æˆ·èœå• |
| è·³è¿‡è®¾ç½® | å¯ä»¥ç¨åè®¾ç½® | å¯ä»¥ä¸€ç›´ä¸è®¾ç½® |

## è®¿é—®è·¯å¾„

### è®¾ç½®æ˜µç§°
1. **Gallery é¡µé¢**: å³ä¸Šè§’ç”¨æˆ·èœå• â†’ Set Username
2. **Chat é¡µé¢**: å³ä¸Šè§’ç”¨æˆ·èœå• â†’ Set Username

### ä¿®æ”¹æ˜µç§°
1. **ä»»æ„é¡µé¢**: ç”¨æˆ·èœå• â†’ Edit Username

### ç™»å‡º
1. **ä»»æ„é¡µé¢**: ç”¨æˆ·èœå• â†’ Sign Out

## éªŒè¯æ¸…å•

- âœ… ç”¨æˆ·èœå•åœ¨ Gallery å’Œ Chat é¡µé¢æ­£å¸¸æ˜¾ç¤º
- âœ… ç‚¹å‡»ç”¨æˆ·èœå•æ˜¾ç¤ºä¸‹æ‹‰èœå•
- âœ… ä¸‹æ‹‰èœå•æ˜¾ç¤ºç”¨æˆ·é‚®ç®±å’Œæ˜µç§°
- âœ… ç‚¹å‡» "Set Username" / "Edit Username" æ‰“å¼€è®¾ç½®çª—å£
- âœ… æ˜µç§°è®¾ç½®çª—å£é¢„å¡«å……å½“å‰æ˜µç§°ï¼ˆå¦‚æœæœ‰ï¼‰
- âœ… ä¿å­˜æ˜µç§°åèœå•ç«‹å³æ›´æ–°
- âœ… ç‚¹å‡»å¤–éƒ¨è‡ªåŠ¨å…³é—­èœå•
- âœ… Sign Out åŠŸèƒ½æ­£å¸¸å·¥ä½œ
- âœ… TypeScript ç±»å‹æ£€æŸ¥é€šè¿‡
- âœ… æ ·å¼ç¬¦åˆåº”ç”¨ä¸»é¢˜

## åç»­ä¼˜åŒ–å»ºè®®

1. **é”®ç›˜å¯¼èˆª**
   - æ”¯æŒ Tab é”®å¯¼èˆªèœå•é¡¹
   - æ”¯æŒ Escape é”®å…³é—­èœå•
   - æ”¯æŒæ–¹å‘é”®é€‰æ‹©èœå•é¡¹

2. **æ›´å¤šèœå•é€‰é¡¹**
   - ç”¨æˆ·è®¾ç½®
   - ä¸»é¢˜åˆ‡æ¢
   - è¯­è¨€é€‰æ‹©
   - æŸ¥çœ‹ä¸ªäººèµ„æ–™

3. **æ˜µç§°éªŒè¯å¢å¼º**
   - å®æ—¶éªŒè¯ï¼ˆè¾“å…¥æ—¶ï¼‰
   - æ˜¾ç¤ºå¯ç”¨æ€§æ£€æŸ¥
   - æ›´å‹å¥½çš„é”™è¯¯æç¤º

4. **å¤´åƒåŠŸèƒ½**
   - æ”¯æŒä¸Šä¼ è‡ªå®šä¹‰å¤´åƒ
   - ä½¿ç”¨ Gravatar
   - å¤´åƒé¢œè‰²ä¸ªæ€§åŒ–

5. **èœå•åŠ¨ç”»ä¼˜åŒ–**
   - æ›´æµç•…çš„å±•å¼€/æ”¶èµ·åŠ¨ç”»
   - èœå•é¡¹æ¸å…¥æ•ˆæœ
   - æ‚¬åœé¢„è§ˆæ•ˆæœ
